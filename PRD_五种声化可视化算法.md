# 产品需求文档 (PRD): 五种声化可视化算法对比测试

## 项目背景

SwingSymphony 是一款将网球挥拍生物力学数据转化为声音节奏（声化/Sonification）的 Web 应用。现有版本使用单一的"时间轴轨道"可视化方式来呈现动力链节奏事件。

为了找到最佳的声化可视化方案，本项目将实现**五种不同的可视化算法**，供用户切换对比，以评估哪种可视化方式能最直观、最有效地传达运动节奏信息。

## 目标

1. 实现五种独立的声化可视化算法
2. 提供统一的算法切换界面，方便用户快速对比
3. 所有算法共享相同的音频引擎和运动数据
4. 为后续 A/B 测试和用户调研提供技术基础

## 数据模型

所有算法共享以下核心数据结构：

```typescript
interface RhythmNode {
  id: string;
  timestamp: number;    // 秒
  intensity: number;    // 0-1 强度
  type: 'KICK' | 'BASS' | 'SNARE' | 'CRASH';  // 动力链阶段
  label: string;        // 标签
}
```

**动力链映射关系：**
| 动力链阶段 | 类型 | 声音 | 颜色 |
|-----------|------|------|------|
| 腿部蓄力 | KICK | 低频鼓点 | 紫色 (#bc13fe) |
| 髋部发力 | BASS | 中低频重击 | 蓝色 (#3b82f6) |
| 肩部旋转 | SNARE | 军鼓 | 绿色 (#0aff60) |
| 手臂/球拍击球 | CRASH | 镲片 | 青色 (#00f3ff) |

---

## 算法一：时间轴轨道 (Timeline Track)

### 概述
经典的多轨道时间线布局，四个水平轨道分别对应动力链的四个阶段，节奏事件显示为轨道上的圆点，红色播放头从左到右移动标示当前时间。

### 可视化描述
- **布局**：垂直排列四条水平轨道，每条轨道左侧有标签区（含图标和名称）
- **节奏节点**：圆形色块定位在对应时间位置，大小和亮度映射强度值
- **播放头**：红色竖线跟随播放时间从左到右移动
- **激活效果**：播放头经过节点时，节点放大1.5倍并发出脉冲光晕
- **背景**：10%间距的垂直网格线提供时间参考

### 适用场景
- 精确时间分析
- 多轨道并行对比
- 音乐制作人/专业教练使用

### 优点
- 直观清晰，类似 DAW（数字音频工作站）界面
- 可以同时观察所有动力链阶段的时序关系
- 便于精确定位时间偏差

### 缺点
- 信息密度较低（大量空白区域）
- 静态布局缺乏动态感
- 对非专业用户可能过于技术化

### 评估维度
- 时间精度直觉性：★★★★★
- 视觉吸引力：★★☆☆☆
- 初学者友好度：★★★☆☆
- 信息密度：★★☆☆☆

---

## 算法二：环形雷达 (Circular Radar)

### 概述
将时间映射到圆形角度，四个同心环分别代表动力链的四个阶段。节奏事件显示为对应环上的弧段/光点，扫描线像雷达一样旋转标示当前时间。

### 可视化描述
- **布局**：四个同心圆环，由内到外分别对应：腿部 → 髋部 → 肩部 → 手臂
- **时间映射**：0° = 开始，360° = 结束（顺时针方向）
- **节奏节点**：弧形色块位于对应环上的角度位置，弧长映射强度
- **扫描线**：发光渐变的径向线从圆心向外扫过，标示当前时间
- **激活效果**：扫描线经过节点时，该节点向外扩散波纹效果
- **中心区域**：显示当前时间数值和播放状态

### 适用场景
- 循环性运动分析
- 整体节奏感知
- 展示/演示场合

### 优点
- 视觉冲击力强，类似游戏HUD界面
- 紧凑布局，空间利用率高
- 自然表达运动的循环性质
- 四个阶段的层级关系一目了然（内→外 = 地面→击球）

### 缺点
- 时间精度感知不如线性布局
- 弧形标记在时间段较短时可能重叠
- 需要用户适应非线性的时间表示

### 评估维度
- 时间精度直觉性：★★★☆☆
- 视觉吸引力：★★★★★
- 初学者友好度：★★★★☆
- 信息密度：★★★★☆

---

## 算法三：粒子爆发 (Particle Burst)

### 概述
每个声音事件触发对应颜色和形态的粒子爆炸效果，粒子的物理属性（速度、大小、轨迹）映射到声音特性（类型、强度）。提供直观的"冲击感"视觉反馈。

### 可视化描述
- **布局**：全屏 Canvas 画布，深色背景
- **粒子发射器**：四个发射点分别对应四个动力链阶段，从下到上垂直排列在左侧
- **粒子特性**：
  - KICK（腿部）：大圆形粒子，向右下方扩散，重力下沉感
  - BASS（髋部）：中等方形粒子，水平扩散，缓慢衰减
  - SNARE（肩部）：小三角形粒子，快速放射状扩散
  - CRASH（手臂）：微小星形粒子，向上喷射，闪烁效果
- **强度映射**：
  - 粒子数量 = intensity × 50（最多50个）
  - 粒子初速度 = intensity × 300 像素/秒
  - 粒子透明度衰减速度 = 1 / (intensity × 2) 秒
- **时间指示器**：底部进度条显示当前播放位置
- **拖尾效果**：粒子带有运动模糊拖尾

### 适用场景
- 娱乐化体验
- 直觉性冲击感反馈
- 吸引初学者和休闲用户

### 优点
- 极强的视觉冲击力和娱乐性
- 直觉映射声音的"力量感"
- 动态效果吸引注意力
- 可以"感受"到每个节奏事件的强弱

### 缺点
- 难以精确读取时间信息
- 粒子衰减后无法回顾历史事件
- 同时多个事件时可能产生视觉混乱
- 计算开销较大

### 评估维度
- 时间精度直觉性：★☆☆☆☆
- 视觉吸引力：★★★★★
- 初学者友好度：★★★★★
- 信息密度：★★☆☆☆

---

## 算法四：波形瀑布 (Waveform Waterfall)

### 概述
实时生成模拟波形，四种声音类型叠加显示为彩色波形。已播放的波形向下滚动形成"瀑布"效果，提供时间维度的深度感。当前播放位置固定在顶部。

### 可视化描述
- **布局**：垂直方向的波形显示区，当前时间位于顶部
- **波形生成**：
  - 每个声音事件在触发时生成对应颜色的正弦波段
  - 波形振幅映射强度（0-1 → 10%-100% 高度）
  - 波形频率映射声音类型（KICK低频→宽波，CRASH高频→密波）
- **瀑布效果**：
  - 波形从上方生成，向下方滚动
  - 透明度随距离递减，创造深度感
  - 滚动速度与播放速度同步
- **层叠显示**：四种类型的波形分层叠加，使用半透明混合
- **当前状态指示器**：顶部水平亮线标示"现在"，附近波形更亮

### 适用场景
- 声音频率直觉理解
- 波形和声音的关联学习
- 连续时间流的感知

### 优点
- 自然映射声音的波形特征
- 提供时间深度感（过去→现在）
- 美观的视觉效果，类似音频频谱仪
- 能看到完整的时间历史

### 缺点
- 不同类型的波形叠加可能难以区分
- 垂直方向的时间流不如水平方向直观
- 精确时间定位较困难
- 波形形态对非技术用户缺乏直觉意义

### 评估维度
- 时间精度直觉性：★★☆☆☆
- 视觉吸引力：★★★★☆
- 初学者友好度：★★☆☆☆
- 信息密度：★★★★★

---

## 算法五：频谱柱状 (Frequency Bar Spectrum)

### 概述
经典的均衡器风格柱状图，四组柱状条分别代表动力链四个阶段。柱状条高度实时响应节奏事件的强度，带有平滑上升和自然衰减效果。

### 可视化描述
- **布局**：四组垂直柱状条并排显示，每组下方标注动力链阶段名称
- **柱状条行为**：
  - 默认状态：低矮基线高度（5%）
  - 事件触发：快速上升至 intensity × 100% 高度（上升时间 50ms）
  - 衰减：指数衰减回基线（衰减时间 500ms）
  - 颜色渐变：从底部基色到顶部亮色
- **峰值标记**：每个柱的最高点留下短暂的峰值线（缓慢下落）
- **底部时间轴**：水平进度条标示播放位置
- **背景网格**：水平虚线标示 25%/50%/75%/100% 强度级别
- **镜像效果**：柱状条向下有倒影/镜像反射

### 适用场景
- 强度/力量对比
- 实时反馈感知
- 音乐可视化爱好者

### 优点
- 极其直观的强度映射
- 经典 EQ 界面，广泛认知
- 可以快速判断各阶段的相对强度
- 实时响应效果好

### 缺点
- 无法显示完整时间轴信息
- 只关注"当前"状态，缺乏历史对比
- 四个柱状组可能过于简单
- 不适合分析精确时序

### 评估维度
- 时间精度直觉性：★★☆☆☆
- 视觉吸引力：★★★★☆
- 初学者友好度：★★★★★
- 信息密度：★★★☆☆

---

## 综合评估对比表

| 评估维度 | 时间轴轨道 | 环形雷达 | 粒子爆发 | 波形瀑布 | 频谱柱状 |
|----------|-----------|---------|---------|---------|---------|
| 时间精度直觉性 | ★★★★★ | ★★★☆☆ | ★☆☆☆☆ | ★★☆☆☆ | ★★☆☆☆ |
| 视觉吸引力 | ★★☆☆☆ | ★★★★★ | ★★★★★ | ★★★★☆ | ★★★★☆ |
| 初学者友好度 | ★★★☆☆ | ★★★★☆ | ★★★★★ | ★★☆☆☆ | ★★★★★ |
| 信息密度 | ★★☆☆☆ | ★★★★☆ | ★★☆☆☆ | ★★★★★ | ★★★☆☆ |
| 实时反馈强度 | ★★★☆☆ | ★★★★☆ | ★★★★★ | ★★★☆☆ | ★★★★★ |

## 技术实现

- **框架**：React 19 + TypeScript + Vite
- **可视化**：Canvas 2D API (粒子/波形), CSS/HTML (轨道/柱状), SVG (雷达)
- **音频**：Web Audio API (共享 audioService)
- **数据**：Mock 数据用于演示，支持后端 API 接入

## 用户交互

- 顶部导航栏提供算法选择器（五个标签页按钮）
- 统一的播放控制面板（播放/暂停、速度、音量）
- 共享的骨架可视化窗口
- 每种算法独立的可视化区域

## 验收标准

1. 五种算法均可独立运行并正确同步音频
2. 切换算法时保持播放状态和时间位置
3. 每种算法的视觉效果符合上述描述
4. 响应式布局，适配不同屏幕尺寸
5. 流畅的 60fps 动画性能
