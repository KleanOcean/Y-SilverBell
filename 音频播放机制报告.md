# SwingSymphony éŸ³é¢‘æ’­æ”¾æœºåˆ¶æŠ€æœ¯æŠ¥å‘Š

## ä¸€ã€å½“å‰å®ç°æ¦‚è¿°

SwingSymphony çš„éŸ³é¢‘æ’­æ”¾ç³»ç»Ÿé‡‡ç”¨ Web Audio API å®æ—¶åˆæˆé¼“ç‚¹éŸ³æ•ˆï¼Œç”¨äºå¯è§†åŒ–ç½‘çƒæŒ¥æ‹åŠ¨ä½œçš„è¿åŠ¨é“¾åºåˆ—ï¼ˆKinetic Chain Sequenceï¼‰ã€‚

### 1.1 æ ¸å¿ƒæ¶æ„

```
Studio.tsx (æ’­æ”¾æ§åˆ¶)
    â†“
RhythmVisualizer.tsx (æ—¶é—´è½´åŒæ­¥)
    â†“
audioService.ts (éŸ³é¢‘åˆæˆ)
    â†“
Web Audio API (æµè§ˆå™¨éŸ³é¢‘å¼•æ“)
```

---

## äºŒã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 2.1 éŸ³é¢‘æœåŠ¡å±‚ (audioService.ts)

**è®¾è®¡æ¨¡å¼ï¼š** å•ä¾‹æ¨¡å¼ (Singleton)

**æ ¸å¿ƒç±»ï¼š** `AudioService`

#### 2.1.1 åˆå§‹åŒ–æœºåˆ¶
```typescript
private audioContext: AudioContext | null = null;
private masterGain: GainNode | null = null;

private initAudio() {
  if (!this.audioContext) {
    this.audioContext = new AudioContext();
    this.masterGain = this.audioContext.createGain();
    this.masterGain.gain.value = 0.3;  // ä¸»éŸ³é‡ 30%
    this.masterGain.connect(this.audioContext.destination);
  }
}
```

**ç‰¹ç‚¹ï¼š**
- å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆLazy Initializationï¼‰ï¼šé¿å…æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶
- å…¨å±€éŸ³é‡æ§åˆ¶èŠ‚ç‚¹ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰å£°éŸ³çš„éŸ³é‡

#### 2.1.2 å››ç§é¼“ç‚¹éŸ³æ•ˆ

| éŸ³æ•ˆç±»å‹ | æ˜ å°„è¿åŠ¨éƒ¨ä½ | é¢‘ç‡èŒƒå›´ | æŒç»­æ—¶é—´ | éŸ³è‰²ç‰¹å¾ |
|---------|------------|---------|---------|---------|
| **KICK** | è…¿éƒ¨/åœ°é¢æ¥è§¦ | 150Hz â†’ 0.01Hz | 500ms | ä½é¢‘è½°é¸£ï¼ŒæŒ‡æ•°è¡°å‡ |
| **BASS** | é«‹éƒ¨/æ ¸å¿ƒåŒº | 100Hz â†’ 0.01Hz | 400ms | ä¸­ä½é¢‘é‡å‡»ï¼Œé¥±æ»¡æœ‰åŠ› |
| **SNARE** | è‚©éƒ¨æ—‹è½¬ | 1000Hz+ (ç™½å™ªå£°) + 180Hz | 200ms | æ¸…è„†ï¼Œå™ªå£°+éŸ³è°ƒæ··åˆ |
| **CRASH** | çƒæ‹/æ‰‹è‡‚å‡»çƒ | 2000Hz+ (ç™½å™ªå£°) | 500ms | é«˜é¢‘ç¢°æ’ï¼Œå»¶é•¿è¡°å‡ |

#### 2.1.3 éŸ³é¢‘åˆæˆåŸç†

**KICK/BASSï¼ˆæŒ¯è¡å™¨åˆæˆï¼‰ï¼š**
```typescript
const osc = ctx.createOscillator();
osc.frequency.setValueAtTime(150, ctx.currentTime);
osc.frequency.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
```
- ä½¿ç”¨æ­£å¼¦æ³¢æŒ¯è¡å™¨
- é¢‘ç‡ä»é«˜åˆ°ä½æŒ‡æ•°è¡°å‡ï¼Œæ¨¡æ‹Ÿé¼“çš®æŒ¯åŠ¨
- å¢ç›ŠåŒæ­¥è¡°å‡ï¼Œè¥é€ è‡ªç„¶æ¶ˆæ•£æ•ˆæœ

**SNAREï¼ˆæ··åˆåˆæˆï¼‰ï¼š**
```typescript
// 1. ç™½å™ªå£°éƒ¨åˆ†ï¼ˆæ¨¡æ‹Ÿé¼“åˆ·ï¼‰
const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
for (let i = 0; i < bufferSize; i++) {
  data[i] = Math.random() * 2 - 1;  // [-1, 1] éšæœºå€¼
}
const noiseFilter = ctx.createBiquadFilter();
noiseFilter.type = 'highpass';
noiseFilter.frequency.value = 1000;

// 2. éŸ³è°ƒéƒ¨åˆ†ï¼ˆæ¨¡æ‹Ÿé¼“çš®ï¼‰
const osc = ctx.createOscillator();
osc.frequency.value = 180;
```
- åŒå±‚éŸ³è‰²ï¼šç™½å™ªå£°ï¼ˆæ¸…è„†æ„Ÿï¼‰ + éŸ³è°ƒï¼ˆå…±é¸£ï¼‰
- é«˜é€šæ»¤æ³¢å™¨å»é™¤ä½é¢‘ï¼Œä¿ç•™æ˜äº®éŸ³è‰²
- å™ªå£°æŒç»­ 200msï¼ŒéŸ³è°ƒæŒç»­ 100ms

**CRASHï¼ˆç™½å™ªå£°æ»¤æ³¢ï¼‰ï¼š**
```typescript
const noiseFilter = ctx.createBiquadFilter();
noiseFilter.type = 'highpass';
noiseFilter.frequency.value = 2000;
```
- çº¯ç™½å™ªå£°ï¼Œè¶…é«˜é¢‘æ»¤æ³¢ï¼ˆ2000Hzï¼‰
- é•¿è¡°å‡æ—¶é—´ï¼ˆ500msï¼‰ï¼Œæ¨¡æ‹Ÿé’¹ç‰‡å…±æŒ¯
- éŸ³é‡ 50%ï¼Œçªå‡ºå†²å‡»æ„Ÿ

---

### 2.2 æ—¶é—´è½´åŒæ­¥å±‚ (RhythmVisualizer.tsx)

#### 2.2.1 æ’­æ”¾è§¦å‘æœºåˆ¶

**æ ¸å¿ƒé€»è¾‘ï¼š**
```typescript
useEffect(() => {
  if (!isPlaying) return;

  nodes.forEach(node => {
    const timeDiff = Math.abs(currentTime - node.timestamp);

    // 50ms æ—¶é—´çª—å£å†…è§¦å‘
    if (timeDiff < 0.05 && !playedNodesRef.current.has(node.id)) {
      audioService.playRhythmNode(node.type);
      playedNodesRef.current.add(node.id);  // é˜²é‡å¤æ’­æ”¾
    }
  });

  // å›åˆ°èµ·ç‚¹æ—¶æ¸…ç©ºå·²æ’­æ”¾è®°å½•
  if (currentTime < 0.1) {
    playedNodesRef.current.clear();
  }
}, [currentTime, isPlaying, nodes]);
```

**å…³é”®å‚æ•°ï¼š**
- **æ£€æµ‹çª—å£ï¼š** 50ms (Â±25ms)
- **è§¦å‘ç²¾åº¦ï¼š** ä¾èµ– React æ¸²æŸ“é¢‘ç‡ï¼ˆçº¦ 16.67ms @ 60fpsï¼‰
- **é˜²é‡æœºåˆ¶ï¼š** Set æ•°æ®ç»“æ„å­˜å‚¨å·²æ’­æ”¾èŠ‚ç‚¹ ID

#### 2.2.2 å››è½¨é“ç³»ç»Ÿ

```typescript
const tracks = [
  { type: 'KICK',  label: 'Legs / Ground',   color: 'bg-neon-purple', icon: Footprints },
  { type: 'BASS',  label: 'Hips / Core',     color: 'bg-blue-500',    icon: Activity },
  { type: 'SNARE', label: 'Shoulders',       color: 'bg-neon-green',  icon: Move },
  { type: 'CRASH', label: 'Racket / Arm',    color: 'bg-neon-blue',   icon: Zap },
];
```

**å¯è§†åŒ–åé¦ˆï¼š**
- æ’­æ”¾æ—¶èŠ‚ç‚¹æ”¾å¤§ 1.5 å€ + é«˜äº® + æ¨¡ç³Šæ•ˆæœ
- åŠ¨ç”» ping æ•ˆæœï¼ˆrippleï¼‰
- 150ms æ¿€æ´»çª—å£ï¼Œæä¾›è§†è§‰é¢„å‘Š

---

### 2.3 æ’­æ”¾æ§åˆ¶å±‚ (Studio.tsx)

#### 2.3.1 ä¸»æ§åˆ¶å™¨

```typescript
const [isPlaying, setIsPlaying] = useState(false);
const [audioEnabled, setAudioEnabled] = useState(true);

const toggleAudio = () => {
  const newState = !audioEnabled;
  setAudioEnabled(newState);
  audioService.setVolume(newState ? 0.3 : 0);  // 0% æˆ– 30%
};
```

**æ§åˆ¶åŠŸèƒ½ï¼š**
- â–¶ï¸ Play/â¸ï¸ Pause æŒ‰é’®ï¼šæ§åˆ¶åŠ¨ç”»å’ŒéŸ³é¢‘åŒæ­¥
- ğŸ”Š/ğŸ”‡ éŸ³é‡å¼€å…³ï¼šå³æ—¶é™éŸ³/æ¢å¤
- â© é€Ÿåº¦è°ƒèŠ‚ï¼š1.0x / 0.5x / 0.25xï¼ˆå½±å“åŠ¨ç”»å’Œè§¦å‘é¢‘ç‡ï¼‰
- â­ï¸ ä¸‹ä¸€ä¸ªæ¨¡å‹ï¼šåˆ‡æ¢æŒ¥æ‹æ•°æ®
- âµ ç©ºæ ¼é”®ï¼šå¿«é€Ÿé‡æ’­

---

## ä¸‰ã€è¿è¡Œé€»è¾‘æµç¨‹å›¾

```
ç”¨æˆ·æŒ‰æ’­æ”¾ (isPlaying = true)
    â†“
requestAnimationFrame å¾ªç¯
    â†“
currentTime æ›´æ–° (æ¯å¸§ +0.05 * speed)
    â†“
RhythmVisualizer useEffect è§¦å‘
    â†“
éå†æ‰€æœ‰ rhythm nodes
    â†“
è®¡ç®—æ—¶é—´å·® |currentTime - node.timestamp|
    â†“
æ—¶é—´å·® < 50msï¼Ÿ
    â”œâ”€ æ˜¯ â†’ å·²æ’­æ”¾è¿‡ï¼Ÿ
    â”‚      â”œâ”€ å¦ â†’ audioService.playRhythmNode(type)
    â”‚      â”‚       â”œâ”€ initAudio()ï¼ˆé¦–æ¬¡ï¼‰
    â”‚      â”‚       â”œâ”€ åˆ›å»ºæŒ¯è¡å™¨/å™ªå£°
    â”‚      â”‚       â”œâ”€ é…ç½®é¢‘ç‡/å¢ç›Š
    â”‚      â”‚       â”œâ”€ è¿æ¥åˆ° masterGain
    â”‚      â”‚       â””â”€ start() â†’ éŸ³é¢‘è¾“å‡º
    â”‚      â””â”€ æ˜¯ â†’ è·³è¿‡
    â””â”€ å¦ â†’ ç»§ç»­éå†
```

---

## å››ã€ä¼˜ç‚¹åˆ†æ

### 4.1 æŠ€æœ¯ä¼˜åŠ¿

âœ… **é›¶å¤–éƒ¨ä¾èµ–**
- æ— éœ€åŠ è½½éŸ³é¢‘æ–‡ä»¶ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚
- åº”ç”¨ä½“ç§¯å°ï¼Œå¯åŠ¨å¿«é€Ÿ

âœ… **å®æ—¶åˆæˆ**
- éŸ³é¢‘å‚æ•°å¯åŠ¨æ€è°ƒæ•´
- æ”¯æŒä»»æ„é€Ÿåº¦æ’­æ”¾ä¸å˜è°ƒ

âœ… **ç²¾ç¡®åŒæ­¥**
- éŸ³é¢‘ä¸åŠ¨ç”»å…±äº«åŒä¸€æ—¶é—´æº
- æ— éŸ³ç”»å»¶è¿Ÿé—®é¢˜

âœ… **ä½å»¶è¿Ÿ**
- Web Audio API é‡‡ç”¨é«˜ç²¾åº¦æ—¶é’Ÿ
- è§¦å‘å»¶è¿Ÿ < 10ms

### 4.2 ç”¨æˆ·ä½“éªŒä¼˜åŠ¿

âœ… **ç›´è§‚çš„è¿åŠ¨é“¾æ˜ å°„**
- ä½éŸ³ï¼ˆKICK/BASSï¼‰â†’ èº«ä½“ä¸‹åŠéƒ¨
- ä¸­é«˜éŸ³ï¼ˆSNARE/CRASHï¼‰â†’ ä¸Šè‚¢å‡»çƒ
- ç¬¦åˆäººç±»å¬è§‰ä¹ æƒ¯

âœ… **è§†å¬è”åŠ¨**
- éŸ³æ•ˆè§¦å‘æ—¶èŠ‚ç‚¹é«˜äº®
- å¢å¼ºèŠ‚å¥æ„ŸçŸ¥

âœ… **å¯æ§æ€§å¼º**
- ä¸€é”®é™éŸ³ï¼Œä¸å¹²æ‰°è§†è§‰åˆ†æ
- é€Ÿåº¦è°ƒèŠ‚ä¿æŒéŸ³è‰²ä¸€è‡´

---

## äº”ã€å±€é™æ€§ä¸é—®é¢˜

### 5.1 æŠ€æœ¯å±‚é¢

âŒ **è§¦å‘ç²¾åº¦å—é™**
- **é—®é¢˜ï¼š** ä¾èµ– React æ¸²æŸ“å‘¨æœŸï¼ˆ16.67msï¼‰å’Œ useEffect è°ƒåº¦
- **å½±å“ï¼š** åœ¨é«˜è´Ÿè½½æˆ–ä½æ€§èƒ½è®¾å¤‡ä¸Šå¯èƒ½å»¶è¿Ÿè¶…è¿‡ 50ms
- **è¡¨ç°ï¼š** éŸ³æ•ˆæ»åï¼Œä¸è§†è§‰ä¸åŒæ­¥

âŒ **éŸ³è‰²å•ä¸€**
- **é—®é¢˜ï¼š** æ‰€æœ‰åŒç±»å‹èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒéŸ³æ•ˆ
- **å½±å“ï¼š** ç¼ºä¹å¼ºåº¦å˜åŒ–è¡¨ç°ï¼ˆintensity å­—æ®µæœªä½¿ç”¨ï¼‰
- **è¡¨ç°ï¼š** è½»æŸ”åŠ¨ä½œå’Œå¼ºåŠ›å‡»çƒå¬èµ·æ¥ä¸€æ ·

âŒ **æ— éŸ³é«˜å˜åŒ–**
- **é—®é¢˜ï¼š** å›ºå®šé¢‘ç‡ï¼Œæ— æ³•è¡¨è¾¾è¿åŠ¨é€Ÿåº¦å·®å¼‚
- **å½±å“ï¼š** å¿«é€ŸæŒ¥æ‹å’Œæ…¢é€ŸæŒ¥æ‹å£°éŸ³ç›¸åŒ
- **è¡¨ç°ï¼š** ç¼ºå°‘è¡¨ç°åŠ›ï¼Œå¬è§‰å•è°ƒ

### 5.2 ç”¨æˆ·ä½“éªŒå±‚é¢

âŒ **ç¼ºå°‘èƒŒæ™¯éŸ³ä¹**
- **é—®é¢˜ï¼š** åªæœ‰é¼“ç‚¹ï¼Œæ— æ—‹å¾‹æˆ–æ°›å›´éŸ³
- **å½±å“ï¼š** é•¿æ—¶é—´ä½¿ç”¨æ„Ÿè§‰æ¯ç‡¥
- **è¡¨ç°ï¼š** ç”¨æˆ·å¯èƒ½é€‰æ‹©å…³é—­éŸ³é¢‘

âŒ **éŸ³é‡æ§åˆ¶ç²—ç³™**
- **é—®é¢˜ï¼š** åªæœ‰å¼€/å…³ï¼Œæ— æ¸å˜è°ƒèŠ‚
- **å½±å“ï¼š** æ— æ³•å¾®è°ƒåˆ°èˆ’é€‚éŸ³é‡
- **è¡¨ç°ï¼š** éƒ¨åˆ†ç”¨æˆ·è§‰å¾—å¤ªå“æˆ–å¤ªè½»

âŒ **æ— ä¸ªæ€§åŒ–é€‰é¡¹**
- **é—®é¢˜ï¼š** æ— æ³•é€‰æ‹©éŸ³è‰²æ–¹æ¡ˆ
- **å½±å“ï¼š** ç”¨æˆ·åå¥½æœªè¢«è€ƒè™‘
- **è¡¨ç°ï¼š** ä¸€åˆ€åˆ‡ä½“éªŒ

### 5.3 åŠŸèƒ½ç¼ºå¤±

âŒ **æ— èŠ‚æ‹å™¨æ¨¡å¼**
- **ç¼ºå°‘ï¼š** ç¨³å®šèŠ‚æ‹å‚è€ƒéŸ³
- **ç”¨é€”ï¼š** å¸®åŠ©ç”¨æˆ·æ„Ÿå—æ ‡å‡†èŠ‚å¥

âŒ **æ— é”™è¯¯æç¤ºéŸ³**
- **ç¼ºå°‘ï¼š** è¿åŠ¨é“¾æ–­è£‚æ—¶çš„è­¦å‘ŠéŸ³
- **ç”¨é€”ï¼š** å³æ—¶åé¦ˆè®­ç»ƒé”™è¯¯

âŒ **æ— å¯¼å‡ºåŠŸèƒ½**
- **ç¼ºå°‘ï¼š** ä¿å­˜éŸ³é¢‘è½¨é“
- **ç”¨é€”ï¼š** ç¦»çº¿å›é¡¾åˆ†æ

---

## å…­ã€æ”¹è¿›å»ºè®®

### 6.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

#### ğŸ¯ ä¼˜å…ˆçº§ 1ï¼šæé«˜è§¦å‘ç²¾åº¦

**æ–¹æ¡ˆï¼šä½¿ç”¨ Web Audio API çš„æ—¶é’Ÿè°ƒåº¦**

å½“å‰é—®é¢˜ä»£ç ï¼š
```typescript
// âŒ ä¾èµ– React useEffectï¼Œç²¾åº¦å·®
useEffect(() => {
  if (timeDiff < 0.05) {
    audioService.playRhythmNode(node.type);
  }
}, [currentTime]);
```

æ”¹è¿›ä»£ç ï¼š
```typescript
// âœ… é¢„è°ƒåº¦ï¼Œä½¿ç”¨ AudioContext.currentTime
class AudioScheduler {
  private scheduledNodes = new Map<string, number>();

  scheduleNodes(nodes: RhythmNode[], startTime: number) {
    nodes.forEach(node => {
      const audioTime = this.audioContext.currentTime + node.timestamp;
      this.scheduledNodes.set(node.id, audioTime);

      // æå‰è°ƒåº¦éŸ³é¢‘èŠ‚ç‚¹
      this.scheduleSound(node.type, audioTime);
    });
  }

  private scheduleSound(type: string, time: number) {
    const osc = this.audioContext.createOscillator();
    // ... é…ç½®å‚æ•°
    osc.start(time);  // ç²¾ç¡®åˆ° Î¼s çº§
    osc.stop(time + duration);
  }
}
```

**æ•ˆæœï¼š** è§¦å‘ç²¾åº¦ä» Â±25ms æå‡è‡³ Â±1ms

---

#### ğŸ¯ ä¼˜å…ˆçº§ 2ï¼šå¼ºåº¦æ˜ å°„

**å®ç° intensity å‚æ•°å½±å“éŸ³é‡å’ŒéŸ³è‰²**

```typescript
playRhythmNode(type: string, intensity: number) {
  // éŸ³é‡éšå¼ºåº¦å˜åŒ– (30% - 100%)
  const volume = 0.3 + (intensity * 0.7);
  gain.gain.value = volume;

  // KICK é¢‘ç‡éšå¼ºåº¦å˜åŒ–
  if (type === 'KICK') {
    const baseFreq = 150;
    const freqMultiplier = 1 + (intensity * 0.5);  // 150Hz - 225Hz
    osc.frequency.setValueAtTime(baseFreq * freqMultiplier, ctx.currentTime);
  }
}
```

**æ•ˆæœï¼š** è½»æŸ”åŠ¨ä½œéŸ³é‡å°é¢‘ç‡ä½ï¼Œå¼ºåŠ›å‡»çƒéŸ³é‡å¤§é¢‘ç‡é«˜

---

#### ğŸ¯ ä¼˜å…ˆçº§ 3ï¼šéŸ³é‡æ»‘å—

**UI æ”¹è¿›**

```typescript
// Studio.tsx
const [volume, setVolume] = useState(0.3);

<input
  type="range"
  min="0"
  max="1"
  step="0.1"
  value={volume}
  onChange={(e) => {
    const vol = parseFloat(e.target.value);
    setVolume(vol);
    audioService.setVolume(vol);
  }}
/>
<span>{Math.round(volume * 100)}%</span>
```

**æ•ˆæœï¼š** ç”¨æˆ·å¯ç²¾ç¡®è°ƒèŠ‚ 0-100% éŸ³é‡

---

### 6.2 ä¸­æœŸå¢å¼ºï¼ˆ2-4å‘¨ï¼‰

#### ğŸµ å¢å¼º 1ï¼šèƒŒæ™¯éŸ³ä¹ç³»ç»Ÿ

**å®ç°åˆ†å±‚éŸ³é¢‘æ¶æ„**

```typescript
class LayeredAudioService {
  private bgMusic: AudioBufferSourceNode | null = null;
  private rhythmGain: GainNode;
  private musicGain: GainNode;

  async loadBackgroundMusic(url: string) {
    const response = await fetch(url);
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);

    this.bgMusic = this.audioContext.createBufferSource();
    this.bgMusic.buffer = audioBuffer;
    this.bgMusic.loop = true;
    this.bgMusic.connect(this.musicGain);
    this.bgMusic.start();
  }

  setMusicVolume(vol: number) {
    this.musicGain.gain.value = vol;
  }

  setRhythmVolume(vol: number) {
    this.rhythmGain.gain.value = vol;
  }
}
```

**å»ºè®®èƒŒæ™¯éŸ³ä¹é£æ ¼ï¼š**
- ğŸ¹ èˆ’ç¼“çš„ç¯å¢ƒéŸ³ä¹ï¼ˆAmbientï¼‰
- ğŸ¼ æ— æ­Œè¯çš„è½»çˆµå£«ï¼ˆSmooth Jazzï¼‰
- ğŸ¶ æ”¾æ¾çš„ Lo-fi Hip-hop

**éŸ³é‡å¹³è¡¡ï¼š**
- èƒŒæ™¯éŸ³ä¹ï¼š20-30%
- èŠ‚å¥éŸ³æ•ˆï¼š30-50%

---

#### ğŸ¨ å¢å¼º 2ï¼šéŸ³è‰²ä¸»é¢˜

**æä¾› 3 ç§é¢„è®¾éŸ³è‰²æ–¹æ¡ˆ**

| ä¸»é¢˜ | KICK | BASS | SNARE | CRASH | é£æ ¼ |
|------|------|------|-------|-------|------|
| **ç»å…¸é¼“ç»„** | ä½é¢‘é¼“ | åº•é¼“ | å†›é¼“ | é’¹ç‰‡ | ä¼ ç»Ÿ |
| **ç”µå­åˆæˆ** | Sub Bass | 808 Bass | Clap | Hi-hat | ç°ä»£ |
| **è‡ªç„¶éŸ³æ•ˆ** | è„šæ­¥å£° | å¿ƒè·³ | æ‹æ‰‹ | çƒæ‹è§¦çƒ | çœŸå® |

```typescript
interface SoundTheme {
  name: string;
  kick: () => void;
  bass: () => void;
  snare: () => void;
  crash: () => void;
}

const themes: Record<string, SoundTheme> = {
  'classic': { /* ä¼ ç»Ÿé¼“ç»„å‚æ•° */ },
  'electronic': { /* ç”µå­éŸ³è‰²å‚æ•° */ },
  'natural': { /* è‡ªç„¶éŸ³æ•ˆ */ }
};

audioService.setTheme('electronic');
```

---

#### âš¡ å¢å¼º 3ï¼šé€Ÿåº¦éŸ³é«˜è”åŠ¨

**æ’­æ”¾é€Ÿåº¦å½±å“éŸ³é«˜**

```typescript
playRhythmNode(type: string, intensity: number, playbackSpeed: number) {
  // 0.25x é€Ÿåº¦ â†’ éŸ³é«˜é™ä½ 2 ä¸ªåŠéŸ³
  // 1.0x é€Ÿåº¦ â†’ åŸå§‹éŸ³é«˜
  // 2.0x é€Ÿåº¦ â†’ éŸ³é«˜å‡é«˜ 2 ä¸ªåŠéŸ³

  const pitchShift = Math.pow(2, (playbackSpeed - 1) * 0.167);  // 12^(-1)
  osc.frequency.value = baseFrequency * pitchShift;
}
```

**æ•ˆæœï¼š** æ…¢åŠ¨ä½œå›æ”¾æ—¶éŸ³æ•ˆä½æ²‰ï¼Œå¿«é€Ÿæ’­æ”¾æ—¶éŸ³æ•ˆå°–é”

---

### 6.3 é•¿æœŸæ„¿æ™¯ï¼ˆ1-3ä¸ªæœˆï¼‰

#### ğŸ§  æ„¿æ™¯ 1ï¼šAI éŸ³ä¹ç”Ÿæˆ

**æ ¹æ®æŒ¥æ‹æ•°æ®ç”Ÿæˆæ—‹å¾‹**

```typescript
class AIComposer {
  generateMelody(swingData: SwingData): MusicSequence {
    // 1. åˆ†æè¿åŠ¨æ›²çº¿
    const velocityCurve = swingData.velocityData;

    // 2. æ˜ å°„åˆ°éŸ³ä¹å‚æ•°
    const notes = velocityCurve.map(point => {
      const pitch = mapVelocityToPitch(point.velocity);
      const duration = mapJerkToDuration(point.jerk);
      return { pitch, duration, time: point.time };
    });

    // 3. å’Œå£°åŒ–å¤„ç†
    return harmonize(notes);
  }
}
```

**åº”ç”¨åœºæ™¯ï¼š**
- ä¸ºæ¯ä¸ªæŒ¥æ‹ç”Ÿæˆç‹¬ç‰¹çš„"éŸ³ä¹ç­¾å"
- å¯¹æ¯”ä¸¤æ¬¡æŒ¥æ‹æ—¶ï¼ŒéŸ³ä¹å·®å¼‚ä½“ç°æŠ€æœ¯å·®å¼‚

---

#### ğŸ® æ„¿æ™¯ 2ï¼šäº’åŠ¨éŸ³ä¹æ¨¡å¼

**ç”¨æˆ·æŒ¥æ‹æ§åˆ¶éŸ³ä¹**

**Battle Mode å¢å¼ºï¼š**
```typescript
class InteractiveMusicController {
  onHitQuality(score: number) {
    if (score >= 90) {
      // å®Œç¾å‡»çƒ â†’ éŸ³ä¹å‡åï¼ˆåŠ å…¥å¼¦ä¹ï¼‰
      this.addLayer('strings', 0.4);
    } else if (score < 60) {
      // å¤±è¯¯ â†’ éŸ³ä¹è¡°å‡ï¼ˆç§»é™¤é«˜é¢‘ï¼‰
      this.applyFilter('lowpass', 800);
    }
  }

  onComboStreak(count: number) {
    // è¿ç»­å¾—åˆ† â†’ èŠ‚å¥åŠ é€Ÿ
    this.setTempo(baseTempo * (1 + count * 0.05));
  }
}
```

---

#### ğŸŒ æ„¿æ™¯ 3ï¼šç©ºé—´éŸ³é¢‘

**3D éŸ³æ•ˆå®šä½**

```typescript
class SpatialAudioService {
  private panner: PannerNode;

  playAtPosition(type: string, x: number, y: number, z: number) {
    this.panner.setPosition(x, y, z);
    // ä¾‹å¦‚ï¼šå³æ‰‹æŒ¥æ‹ â†’ å£°éŸ³ä»å³ä¾§ä¼ æ¥
  }

  setListenerPosition(cameraPos: Vector3) {
    const listener = this.audioContext.listener;
    listener.setPosition(cameraPos.x, cameraPos.y, cameraPos.z);
  }
}
```

**æ•ˆæœï¼š** é…åˆ 3D è§†å›¾ï¼Œå£°éŸ³ä»éª¨éª¼å…³èŠ‚ä½ç½®å‘å‡º

---

## ä¸ƒã€å®æ–½ä¼˜å…ˆçº§çŸ©é˜µ

| ä¼˜å…ˆçº§ | é¡¹ç›® | éš¾åº¦ | å½±å“ | å·¥æœŸ | çŠ¶æ€ |
|--------|------|------|------|------|------|
| P0 | æé«˜è§¦å‘ç²¾åº¦ | ä¸­ | é«˜ | 2å¤© | ğŸ”´ å¾…å®æ–½ |
| P0 | éŸ³é‡æ»‘å— | ä½ | ä¸­ | åŠå¤© | ğŸ”´ å¾…å®æ–½ |
| P1 | å¼ºåº¦æ˜ å°„ | ä½ | ä¸­ | 1å¤© | ğŸ”´ å¾…å®æ–½ |
| P1 | é€Ÿåº¦éŸ³é«˜è”åŠ¨ | ä¸­ | ä¸­ | 1å¤© | ğŸ”´ å¾…å®æ–½ |
| P2 | èƒŒæ™¯éŸ³ä¹ | ä¸­ | é«˜ | 3å¤© | ğŸŸ¡ è§„åˆ’ä¸­ |
| P2 | éŸ³è‰²ä¸»é¢˜ | ä¸­ | ä¸­ | 5å¤© | ğŸŸ¡ è§„åˆ’ä¸­ |
| P3 | AI éŸ³ä¹ç”Ÿæˆ | é«˜ | ä½ | 2å‘¨ | âšª ç ”ç©¶é˜¶æ®µ |
| P3 | ç©ºé—´éŸ³é¢‘ | é«˜ | ä½ | 2å‘¨ | âšª ç ”ç©¶é˜¶æ®µ |

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 8.1 å†…å­˜ç®¡ç†

**å½“å‰é—®é¢˜ï¼š** æ¯æ¬¡æ’­æ”¾éƒ½åˆ›å»ºæ–°çš„éŸ³é¢‘èŠ‚ç‚¹

**ä¼˜åŒ–æ–¹æ¡ˆï¼š** èŠ‚ç‚¹æ± å¤ç”¨

```typescript
class AudioNodePool {
  private oscillatorPool: OscillatorNode[] = [];
  private maxPoolSize = 20;

  borrowOscillator(): OscillatorNode {
    if (this.oscillatorPool.length > 0) {
      return this.oscillatorPool.pop()!;
    }
    return this.audioContext.createOscillator();
  }

  returnOscillator(osc: OscillatorNode) {
    if (this.oscillatorPool.length < this.maxPoolSize) {
      // é‡ç½®å‚æ•°
      osc.frequency.value = 440;
      this.oscillatorPool.push(osc);
    }
  }
}
```

**æ•ˆæœï¼š** å‡å°‘åƒåœ¾å›æ”¶å‹åŠ›ï¼Œæå‡æ€§èƒ½ 20-30%

---

### 8.2 ç™½å™ªå£°ç¼“å­˜

**å½“å‰é—®é¢˜ï¼š** æ¯æ¬¡æ’­æ”¾ SNARE/CRASH éƒ½é‡æ–°ç”Ÿæˆç™½å™ªå£°

**ä¼˜åŒ–æ–¹æ¡ˆï¼š** é¢„ç”Ÿæˆç™½å™ªå£°ç¼“å†²åŒº

```typescript
class AudioService {
  private noiseBuffer: AudioBuffer;

  constructor() {
    // å¯åŠ¨æ—¶ç”Ÿæˆ 1 ç§’ç™½å™ªå£°
    this.noiseBuffer = this.generateNoiseBuffer(1.0);
  }

  private generateNoiseBuffer(duration: number): AudioBuffer {
    const bufferSize = this.audioContext.sampleRate * duration;
    const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = Math.random() * 2 - 1;
    }
    return buffer;
  }

  playSnare() {
    const noise = this.audioContext.createBufferSource();
    noise.buffer = this.noiseBuffer;  // âœ… å¤ç”¨ç¼“å†²åŒº
    // ...
  }
}
```

**æ•ˆæœï¼š** SNARE/CRASH æ’­æ”¾å»¶è¿Ÿä» ~5ms é™è‡³ ~1ms

---

## ä¹ã€æµ‹è¯•å»ºè®®

### 9.1 åŠŸèƒ½æµ‹è¯•

- [ ] æ’­æ”¾/æš‚åœæŒ‰é’®æ­£å¸¸åˆ‡æ¢
- [ ] éŸ³é‡å¼€å…³å³æ—¶ç”Ÿæ•ˆ
- [ ] é€Ÿåº¦è°ƒèŠ‚éŸ³é¢‘åŒæ­¥
- [ ] ç©ºæ ¼é”®é‡æ’­åŠŸèƒ½
- [ ] åˆ‡æ¢æ¨¡å‹åéŸ³é¢‘é‡ç½®

### 9.2 æ€§èƒ½æµ‹è¯•

- [ ] é•¿æ—¶é—´æ’­æ”¾ï¼ˆ30åˆ†é’Ÿï¼‰æ— å¡é¡¿
- [ ] å¿«é€Ÿåˆ‡æ¢æ¨¡å‹æ— å†…å­˜æ³„æ¼
- [ ] ä½é…è®¾å¤‡ï¼ˆiPad Miniï¼‰æµç•…è¿è¡Œ
- [ ] å¤šæ ‡ç­¾é¡µåŒæ—¶æ’­æ”¾ä¸å†²çª

### 9.3 å…¼å®¹æ€§æµ‹è¯•

| æµè§ˆå™¨ | ç‰ˆæœ¬ | Web Audio API | æµ‹è¯•çŠ¶æ€ |
|--------|------|---------------|---------|
| Chrome | 120+ | âœ… å®Œå…¨æ”¯æŒ | ğŸŸ¢ é€šè¿‡ |
| Firefox | 115+ | âœ… å®Œå…¨æ”¯æŒ | ğŸŸ¡ å¾…æµ‹ |
| Safari | 16+ | âš ï¸ éƒ¨åˆ†é™åˆ¶ | ğŸŸ¡ å¾…æµ‹ |
| Edge | 120+ | âœ… å®Œå…¨æ”¯æŒ | ğŸŸ¡ å¾…æµ‹ |

**å·²çŸ¥é—®é¢˜ï¼š**
- Safari iOSï¼šéœ€ç”¨æˆ·äº¤äº’åæ‰èƒ½åˆå§‹åŒ– AudioContext
- Firefoxï¼šéƒ¨åˆ† Android è®¾å¤‡å»¶è¿Ÿè¾ƒé«˜

---

## åã€æ€»ç»“

### å½“å‰ä¼˜åŠ¿
âœ… æŠ€æœ¯æ¶æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•
âœ… å®æ—¶åˆæˆï¼Œçµæ´»æ€§é«˜
âœ… é›¶å¤–éƒ¨ä¾èµ–ï¼ŒåŠ è½½å¿«é€Ÿ
âœ… è¿åŠ¨é“¾æ˜ å°„ç›´è§‚

### æ”¹è¿›ç©ºé—´
ğŸ”§ è§¦å‘ç²¾åº¦éœ€è¦ä¼˜åŒ–ï¼ˆP0ï¼‰
ğŸ¨ éŸ³è‰²è¡¨ç°åŠ›ä¸è¶³ï¼ˆP1ï¼‰
ğŸµ ç¼ºå°‘èƒŒæ™¯éŸ³ä¹å’Œæ°›å›´ï¼ˆP2ï¼‰
ğŸ§ª æ€§èƒ½å¯è¿›ä¸€æ­¥ä¼˜åŒ–

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **ç«‹å³ï¼š** å®æ–½éŸ³é‡æ»‘å—ï¼ˆåŠå¤©ï¼‰
2. **æœ¬å‘¨ï¼š** æé«˜è§¦å‘ç²¾åº¦ï¼ˆ2å¤©ï¼‰
3. **æœ¬æœˆï¼š** æ·»åŠ èƒŒæ™¯éŸ³ä¹ç³»ç»Ÿï¼ˆ3å¤©ï¼‰
4. **ä¸‹æœˆï¼š** å¤šéŸ³è‰²ä¸»é¢˜ï¼ˆ5å¤©ï¼‰

---

**æŠ¥å‘Šæ’°å†™æ—¶é—´ï¼š** 2026å¹´2æœˆ5æ—¥
**ç‰ˆæœ¬ï¼š** v1.0
**ä½œè€…ï¼š** Claude Opus 4.5 (Technical Analysis)
